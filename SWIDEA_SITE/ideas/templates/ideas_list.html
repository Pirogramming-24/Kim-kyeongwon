{% extends 'base.html' %}

{% block title %}ì•„ì´ë””ì–´ ëª©ë¡{% endblock %}

{% block extra_css %}
<style>
    .page-title {
        text-align: center;
        color: #fff;
        margin-bottom: 2.0rem;
    }
    
    .page-title h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }

    .search-bar {
        background: #fff;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2.0rem;
    }
    
    .search-bar form {
        display: flex;
        gap: 1.0rem;
        flex-wrap: wrap;
    }
    
    .search-bar input[type="text"] {
        flex: 1;
        min-width: 200px;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 8px;
    }
    
    .search-bar select {
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 8px;
    }

    .ideas-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 2.0rem;
        margin-bottom: 2.0rem;
    }
    
    @media (max-width: 1200px) {
        .ideas-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    
    @media (max-width: 900px) {
        .ideas-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 600px) {
        .ideas-grid {
            grid-template-columns: 1fr;
        }
    }

    .idea-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .idea-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.2);
    }

    .idea-image {
        position: relative;
        width: 100%;
        height: 200px;
        background: #f0f0f0;
    }
    
    .idea-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .star-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #fff;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
    }
    
    .star-btn.active {
        color: rgba(255, 217, 0);
    }

    .idea-info {
        padding: 1.5rem;
    }
    
    .idea-info h3 {
        margin-bottom: 0.5rem;
    }
    
    .idea-info h3 a {
        color: #333;
        text-decoration: none;
    }
    
    .idea-info h3 a:hover {
        color: #667eea;
    }

    .idea-meta {
        display: flex;
        justify-content: space-between;
        padding-top: 1.0rem;
        border-top: 1px solid #eee;
        margin-top: 1.0rem;
    }
    
    .devtool-name {
        color: #667eea;
        font-weight: bold;
    }
    
    .star-count {
        color: #999;
    }

    .interest-control {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }
    
    .interest-control button {
        background: #667eea;
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        cursor: pointer;
    }
    
    .interest-value {
        font-weight: bold;
        color: #667eea;
        min-width: 40px;
        text-align: center;
    }

    .empty {
        text-align: center;
        padding: 4.0rem 2.0rem;
        background: white;
        border-radius: 12px;
    }
    
    .empty h2 {
        color: #999;
        margin-bottom: 1.0rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- í˜ì´ì§€ ì œëª© -->
<div class="page-title">
    <h1>ğŸ’¡ ì•„ì´ë””ì–´ ëª©ë¡</h1>
</div>

<!-- ê²€ìƒ‰ ë° ì •ë ¬ -->
<div class="search-bar">
    <form method="get">
        <input type="text" name="search" placeholder="ì•„ì´ë””ì–´ ê²€ìƒ‰.." value="{{ search }}">
        <select name="sort" onchange="this.form.submit()">
            <option value="-created" {% if sort == '-created' %}selected{% endif %}>ìµœì‹ ìˆœ</option>
            <option value="created" {% if sort == 'created' %}selected{% endif %}>ë“±ë¡ìˆœ</option>
            <option value="star" {% if sort == 'star' %}selected{% endif %}>ì°œí•˜ê¸°ìˆœ</option>
            <option value="title" {% if sort == 'title' %}selected{% endif %}>ì´ë¦„ìˆœ</option>
            <option value="interest" {% if sort == 'interest' %}selected{% endif %}>ê´€ì‹¬ë„ìˆœ</option>
        </select>
        <button type="submit" class="btn">ê²€ìƒ‰</button>
    </form>
</div>

<!-- ì•„ì´ë””ì–´ ëª©ë¡ -->
{% if page_obj %}
    <div class="ideas-grid">
        {% for idea in page_obj %}
        <div class="idea-card">
            <!-- ì´ë¯¸ì§€ -->
            <div class="idea-image">
                {% if idea.image %}
                    <img src="{{ idea.image.url }}" alt="{{ idea.title }}">
                {% else %}
                    <img src="https://via.placeholder.com/300x200?text=No+Image" alt="ì´ë¯¸ì§€ ì—†ìŒ">
                {% endif %}
                
                <!-- ì°œí•˜ê¸° ë²„íŠ¼ -->
                <button class="star-btn {% if idea.is_starred %}active{% endif %}" 
                        onclick="toggleStar(event, '{{ idea.pk }}', this)">
                    {% if idea.is_starred %}â˜…{% else %}â˜†{% endif %}
                </button>
            </div>
            
            <!-- ì •ë³´ -->
            <div class="idea-info">
                <h3><a href="{% url 'ideas:ideas_detail' idea.pk %}">{{ idea.title }}</a></h3>
                
                <div class="idea-meta">
                    <span class="devtool-name">{{ idea.devtool.name }}</span>
                    <span class="star-count">ì°œ {{ idea.star_count }}ê°œ</span>
                </div>
                
                <!-- ê´€ì‹¬ë„ ì¡°ì ˆ -->
                <div class="interest-control">
                    <button onclick="changeInterest('{{ idea.pk }}', -1)">-</button>
                    <span class="interest-value" id="interest-{{ idea.pk }}">{{ idea.interest }}</span>
                    <button onclick="changeInterest('{{ idea.pk }}', 1)">+</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if sort %}&sort={{ sort }}{% endif %}{% if search %}&search={{ search }}{% endif %}">ì²˜ìŒ</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if sort %}&sort={{ sort }}{% endif %}{% if search %}&search={{ search }}{% endif %}">ì´ì „</a>
        {% endif %}
        
        <span class="current">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if sort %}&sort={{ sort }}{% endif %}{% if search %}&search={{ search }}{% endif %}">ë‹¤ìŒ</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if sort %}&sort={{ sort }}{% endif %}{% if search %}&search={{ search }}{% endif %}">ë§ˆì§€ë§‰</a>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    <div class="empty">
        <h2>ë“±ë¡ëœ ì•„ì´ë””ì–´ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
        <a href="{% url 'ideas:ideas_create' %}" class="btn">ì•„ì´ë””ì–´ ë“±ë¡í•˜ê¸°</a>
    </div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
// ì°œí•˜ê¸° ë²„íŠ¼ í´ë¦­
function toggleStar(event, ideaId, button) {
    event.preventDefault();
    event.stopPropagation();
    
    // ì„œë²„ì— ìš”ì²­
    fetch('/ideas/' + ideaId + '/star/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
        },
    })
    .then(response => response.json())
    .then(data => {
        // ë³„ ëª¨ì–‘ ë³€ê²½
        if (data.is_starred) {
            button.textContent = 'â˜…';
            button.classList.add('active');
        } else {
            button.textContent = 'â˜†';
            button.classList.remove('active');
        }
        
        // ì°œ ê°œìˆ˜ ì—…ë°ì´íŠ¸
        const card = button.closest('.idea-card');
        const starCount = card.querySelector('.star-count');
        starCount.textContent = 'ì°œ ' + data.star_count + 'ê°œ';
    })
    .catch(error => {
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// ê´€ì‹¬ë„ ì¡°ì ˆ
function changeInterest(ideaId, change) {
    const url = change > 0 
        ? '/ideas/' + ideaId + '/interest/increase/'
        : '/ideas/' + ideaId + '/interest/decrease/';
    
    // ì„œë²„ì— ìš”ì²­
    fetch(url, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
        },
    })
    .then(response => response.json())
    .then(data => {
        // ê´€ì‹¬ë„ ìˆ«ì ì—…ë°ì´íŠ¸
        const element = document.getElementById('interest-' + ideaId);
        element.textContent = data.interest;
    })
    .catch(error => {
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}
</script>
{% endblock %}